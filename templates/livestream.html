{% extends "base.html" %}

{% block title %}Hiệu chỉnh{% endblock %}

{% block content %}
<div class="d-flex" id="wrapper">
    {% include 'sidebar.html' %}
    <div id="page-content-wrapper" style="width: 85%;">
        <nav class="navbar navbar-expand-lg navbar-light bg-light py-4 px-4">
            <h2 class="fs-2 m-0">
                Hiệu chỉnh
            </h2>
            </nav>

        <div class="container-fluid px-4 mt-4">
            <div id="main-content-area">
                <h3 class="mb-4">Hiệu chỉnh đường ngắm & thử nghiệm - Kiểm tra kết nối</h3>
                
                <div id="connection-status-banner" class="mb-3 fw-bold">
                    <i class="fas fa-plug"></i> <span id="connection-text">Đang kiểm tra kết nối...</span>
                </div>

                <div id="controls-container" class="mb-3 p-3 border rounded bg-light" style="display: none;">
                    <h5><i class="fas fa-camera me-2"></i>Điều khiển Camera</h5>
                    <div class="d-flex align-items-center flex-wrap">
                        <button id="calibrate-btn" class="btn btn-sm btn-warning me-4">
                            <i class="fas fa-crosshairs me-1"></i> Hiệu chỉnh tâm
                        </button>
                        <div class="d-flex align-items-center">
                            <label for="zoom-slider" class="form-label me-2 mb-0 fw-bold">Zoom:</label>
                            <input type="range" class="form-range" id="zoom-slider" min="1.0" max="5.0" value="1.0" step="0.1" style="width: 200px;">
                            <span id="zoom-value-display" class="fw-bold mx-3">1.0x</span>
                            <button id="zoom-apply-btn" class="btn btn-sm btn-secondary">Áp dụng</button>
                        </div>
                    </div>
                    <small id="calibrate-helper-text" class="form-text text-muted mt-2" style="display: none;">Nhấp vào một điểm trên video để đặt làm tâm ngắm mới.</small>
                </div>

                <div class="row g-4">
                    <div class="col-md-8">
                        <div class="video-container livestream-frame mb-3">
                            <div id="status-message" class="text-white text-center d-flex flex-column justify-content-center align-items-center" style="position: absolute; top: 0; left: 0; right: 0; bottom: 0; font-size: 1.5rem; background-color: rgba(0, 0, 0, 0.7);">
                                <i class="fas fa-exclamation-triangle mb-3"></i>
                                <p>Không có luồng video</p>
                                <small>Đang chờ kết nối từ thiết bị...</small>
                            </div>
                            <img src="" id="video-feed" class="img-fluid rounded" alt="Luồng video trực tiếp" style="height: 100%; width: 100%; object-fit: contain;">
                        </div>
                    </div>
                    <div class="col-md-4">
                        <div class="bg-white p-4 rounded shadow-sm h-100 d-flex flex-column justify-content-center align-items-center text-center">
                            <div id="info-placeholder">
                                <i class="fas fa-info-circle fa-4x text-muted mb-3"></i>
                                <h4 class="text-muted">Thông tin sẽ hiển thị khi có kết nối</h4>
                                <p class="text-muted">Đang chờ dữ liệu từ hệ thống</p>
                            </div>
                            <div id="info-display" style="display: none;">
                                <h4 class="mb-4">Kết quả bắn</h4>
                                <ul class="list-group list-group-flush mb-4">
                                    <li class="list-group-item d-flex justify-content-between align-items-center">
                                        <strong>Thời gian bắn:</strong>
                                        <span id="shot-time" class="text-primary">--:--</span>
                                    </li>
                                    <li class="list-group-item d-flex justify-content-between align-items-center">
                                        <strong>Tên mục tiêu:</strong>
                                        <span id="target" class="text-primary">--</span>
                                    </li>
                                    <li class="list-group-item d-flex justify-content-between align-items-center">
                                        <strong>Điểm:</strong>
                                        <span id="shot-score" class="text-danger fs-3 fw-bold">--</span>
                                    </li>
                                </ul>
                                <h5 class="mt-4">Vị trí điểm chạm</h5>
                                <div class="text-center">
                                    <div id="target-image-container" style="width: 250px; height: 250px; border: 1px solid #ccc; margin: auto; background-color: #f8f9fa; display: flex; align-items: center; justify-content: center;">
                                        <img id="target-image" src="https://i.imgur.com/G5T5j92.png" alt="Mô hình bia" style="width: 100%; height: 100%; object-fit: contain;">
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>
</div>
{% endblock %}

{% block scripts %}
<link rel="stylesheet" href="{{ url_for('static', filename='css/all.min.css') }}">
<link rel="stylesheet" href="{{ url_for('static', filename='css/stream.css') }}">
<script src="{{ url_for('static', filename='js/stream.js') }}"></script>
{% endblock %}