{% extends "base.html" %}

{% block title %}Chế độ 2{% endblock %}

{% block content %}
<div class="d-flex" id="wrapper">
    {% include 'sidebar.html' %}
    <div id="page-content-wrapper" style="width: 85%;">
        <nav class="navbar navbar-expand-lg navbar-light bg-light py-4 px-4">
            <h2 class="fs-2 m-0">
                Chế độ 2
                <span id="soldier-info" class="text-muted fs-4 ms-2 d-none"></span>
            </h2>
            <div class="ms-auto">
                <a href="#" id="back-to-livestream" class="btn btn-secondary">
                    <i class="fas fa-arrow-left me-1"></i> Quay lại
                </a>
            </div>
        </nav>
        <div class="container-fluid px-4 mt-4">
            <h3 class="mb-4">Giao diện của chế độ 2</h3>
            <p>Bạn có thể thiết kế nội dung cho chế độ này tại đây.</p>
        </div>
    </div>
</div>
{% endblock %}

{% block scripts %}
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.15.4/css/all.min.css">
<script>
    document.addEventListener('DOMContentLoaded', async function() {
        const soldierInfoEl = document.getElementById('soldier-info');
        const backButton = document.getElementById('back-to-livestream');

        // Lấy ID từ sessionStorage
        const soldierId = sessionStorage.getItem('soldierId');

        if (soldierId) {
            try {
                const response = await fetch(`/api/soldiers/${soldierId}`);
                const data = await response.json();
                if (response.ok) {
                    soldierInfoEl.textContent = `(Chiến sĩ: ${data.rank} ${data.name})`;
                    soldierInfoEl.classList.remove('d-none');
                } else {
                    console.error('Lỗi khi lấy thông tin chiến sĩ:', data.error);
                }
            } catch (error) {
                console.error('Lỗi mạng khi lấy thông tin chiến sĩ:', error);
            }
            
            // Cập nhật đường dẫn cho nút quay lại
            backButton.href = `/livestream?soldier_id=${soldierId}`;

        } else {
            // Nếu không có soldierId, quay lại trang livestream mặc định
            backButton.href = `/livestream`;
        }
    });
</script>
{% endblock %}